<%
var statusClass =   (isBanned)  ? 'is-banned' :
                    (isOp)      ? 'is-op' :
                    (isOwner)   ? 'is-owner' :
                    (isAdmin)   ? 'is-admin' :
                    (isMember)  ? 'is-member' : 'is-not-member';
%>
<div class="header flex-parent">
    <img class="avatar group open-group-profile curp" data-group-id="<%= group.group_id %>" src="<%= group.avatarUrl %>" alt="<%= group.identifier %> avatar">
    <div class="info flex-child flex-parent column">
        <div class="flex-parent">
            <div class="name open-group-profile curp" data-group-id="<%= group.group_id %>"><%= group.name %></div>
            <div class="flex-child"></div>
            <div class="dropdown flex-parent jc-center center">
                <button class="dropdown-toggle flex-parent jc-center center" data-toggle="dropdown" aria-expanded="true">
                    <i class="icon icon-cog icon-fw"></i>
                </button>
                <ul class="dropdown-menu" role="menu">
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" class="open-group-profile" data-group-id="<%= group.group_id %>">
                            <i class="icon icon-eye"></i> <%= t('global.viewprofile') %>
                        </a>
                    </li>
                    <% if (isOp || isOwner || isAdmin) { %>
                        <li role="presentation" class="divider"></li>
                    <% } %>
                    <% if (isOwner || isAdmin ) { %>
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" class="open-group-edit" data-group-id="<%= group.group_id %>">
                            <i class="icon icon-pencil"></i> <%= t('global.edit') %>
                        </a>
                    </li>
                    <% }; %>
                    <% if (isOp || isOwner || isAdmin) { %>
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" class="open-group-access" data-group-id="<%= group.group_id %>">
                            <i class="icon icon-public"></i> <%= t('chat.access.link') %>
                        </a>
                    </li>
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" class="open-group-users" data-group-id="<%= group.group_id %>">
                            <i class="icon icon-users"></i> <%= t('group.members') %>
                        </a>
                    </li>
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" class="open-group-users-allowed" data-group-id="<%= group.group_id %>">
                            <i class="icon icon-verified-user"></i> <%= t('profile.group.usersallowed') %>
                        </a>
                    </li>
                    <% }; %>
                    <% if (!isOwner && isMember) { %>
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1" class="quit-group" data-group-id="<%= group.group_id %>">
                            <i class="icon icon-times"></i> <%= t('group.close') %>
                        </a>
                    </li>
                    <% } %>
                </ul>
            </div>
            <div class="separator"></div>
            <div role="presentation" class="share flex-parent jc-center center">
                <a role="menuitem" class="clean facebook flex-parent jc-center center" tabindex="-1" data-toggle="tooltip" data-placement="left" title="<%= t('chat.share.on', {name: 'Facebook'}) %>" >
                    <i class="icon icon-facebook-square"></i>
                </a>
            </div>
            <div role="presentation" class="share flex-parent jc-center center">
                <a role="menuitem" class="clean twitter flex-parent jc-center center" tabindex="-1" data-toggle="tooltip" data-placement="left" title="<%= t('chat.share.on', {name: 'Twitter'}) %>" >
                    <i class="icon icon-twitter-square"></i>
                </a>
            </div>
            <div role="presentation" class="share flex-parent jc-center center">
                <a role="menuitem" class="clean googleplus flex-parent jc-center center" tabindex="-1" data-toggle="tooltip" data-placement="left" title="<%= t('chat.share.on', {name: 'Google'}) %>" >
                    <i class="icon icon-google-plus-square"></i>
                </a>
            </div>
        </div>

        <div class="links flex-parent center">
            <% if(group.website) { %>
                <a class="link" href="<%= group.website.href %>" target="_blank"><%= group.website.title %></a>
            <% } %>

            <span class="link"><%= t('profile.group.createdat') %> <%= created %></span>
            <span class="link flex-parent center"><i class="icon users-icon mr5"></i> <%=group.members.length%></span>

        </div>

        <% if(group.description) { %>
            <div class="description"><%= group.description %></div>
        <% } %>

        <div class="users flex-parent center">

            <!--Display owner-->
            <div class="flex-parent column owner">
                <span class="title">Owner</span>
                <div class="flex-parent center">
                    <img class="avatar group open-user-profile curp" data-user-id="<%= group_users.owner.user_id %>" src="<%= group_users.owner.avatar %>" title="<%= group_users.owner.username %>" data-toggle="tooltip" data-placement="top" />
                    <span class="username">@<%=group_users.owner.username%></span>
                </div>
            </div>

            <!--Display op-->
            <% if(group_users.op.length > 0) { %>
                <div class="flex-parent column">
                    <span class="title">Op <span class="count"><%=group_users.op.length%></span></span>
                    <div class="flex-parent center">
                        <% var count = 0; %>
                        <%_.find(group_users.op, function (u) { %>
                        <img class="avatar group open-user-profile curp" data-user-id="<%= u.user_id %>" src="<%= u.avatar %>" title="<%= u.username %>" data-toggle="tooltip" data-placement="top" />
                        <% count ++; %>
                        <% if (count === 6) { %><i class="icon ellipsis-icon"></i><% return true; } %>
                        <% }); %>
                    </div>
                </div>
            <% } %>

            <!--Display members-->
            <% if ((isMember || isOwner) && !isBanned) { %>
                <% if(group_users.members.length > 0) { %>
                    <div class="flex-parent column">
                        <span class="title">Members <span class="count"><%=group_users.members.length%></span></span>
                        <div class="flex-parent center">
                            <% var count = 0; %>
                            <%_.find(group_users.members, function (u) { %>
                                <img class="avatar group open-user-profile curp" data-user-id="<%= u.user_id %>" src="<%= u.avatar %>" title="<%= u.username %>" data-toggle="tooltip" data-placement="top" />
                                <% count ++; %>
                                <% if (count === 6) { %><i class="icon ellipsis-icon"></i><% return true; } %>
                            <% }); %>
                        </div>
                    </div>
                <% } %>
            <% } %>

            <div class="flex-child"></div>

            <div class="action-ctn flex-parent <%=statusClass%>">
                <!--Banned message-->
                <% if (isBanned) { %>
                    <span class="banned-message"><%= t('chat.blocked.groupban') %></span>
                <% } else { %>
                    <span class="donut-button transparent toggle-collapse">
                        <i class="icon i-icon show-is-member show-is-not-member"></i>
                        <i class="icon icon-owner show-is-owner"></i>
                        <i class="icon deop-icon show-is-op"></i>
                        <i class="icon icon-star cl-warning show-is-admin"></i>
                    </span>

                    <% if (isOwner || isOp || isAdmin || isMember) { %>
                        <!--Create a donut-->
                        <span class="curp open-create-room donut-button black" data-group-id="<%=group.group_id%>" data-group-name="<%=group.name%>"><%= t('actions.create') %></span>
                    <% } else { %>
                        <!--Ask membership button for non members-->
                        <span class="curp btn btn-primary group-join"><%= t('group.ask-membership') %></span>
                    <% } %>
                <% } %>
            </div>
        </div>

        <div class="flex-child"></div>
    </div>
</div>

<div class="header-below <%=statusClass%>">
    <span class="arrow"></span>
    <div class="block-ctn flex-parent center">
        <div class="group-icon-ctn flex-parent jc-center center">
            <div class="group-icon"></div>
        </div>

        <% if (isBanned) { %>
            <div class="text">
                <%= t('chat.blocked.groupbanned', {at: banned_at}) %>
                <% if (reason) { %>
                    <%= t('chat.blocked.reason') %>
                    <br/>
                    <span class="reason"><em><%- reason %></em></span>
                <% } %>
            </div>
            <div class="flex-child"></div>
            <div class="actions">
                <span class="donut-button transparent toggle-collapse curp"><i class="icon icon-times"></i></span>
            </div>

        <% } else if (isOwner || isOp || isAdmin) { %>
            <div class="text">
                <% if (isOwner) { %>
                    <%= t('group.default-owner') %>
                <% } else if (isOp) { %>
                    <%= t('group.default-op') %>
                <% } else { %>
                    <%= t('group.default-admin') %>
                <% } %>
            </div>
            <div class="flex-child"></div>
            <div class="actions">
                <span type="button" class="curp donut-button gray open-group-users mr15" data-group-id="<%= group.group_id %>" ><%= t('group.manage') %></span>
                <span type="button" class="curp donut-button gray open-group-users-allowed" data-group-id="<%= group.group_id %>"><%= t('group.invite')%></span>
                <span class="donut-button transparent toggle-collapse curp"><i class="icon icon-times"></i></span>
            </div>

        <% } else if (isMember) { %>
            <div class="text"><%= t('group.default-member') %></div>
            <div class="flex-child"></div>
            <div class="actions">
                <span class="donut-button transparent toggle-collapse curp"><i class="icon icon-times"></i></span>
            </div>

        <% } else { %>
            <div class="text">
                <% if (group.disclaimer) { %>
                    <p><%= t('group.disclaimer-start') %><strong><span class="open-user-profile fs15 dc-text" data-user-id="<%=group.owner_id %>"></span></strong><%= t('group.disclaimer-end') %></p>
                    <p class="mt10"><em><%= t('chat.joingroup.disclaimer', {username: group.owner_username ,disclaimer: group.disclaimer}) %></em></p>
                <% } else { %>
                    <p><%= t('group.default-disclaimer') %></p>
                <% } %>
            </div>
            <div class="flex-child"></div>
            <div class="actions">
                <span class="donut-button transparent toggle-collapse curp"><i class="icon icon-times"></i></span>
            </div>
        <% } %>
    </div>
</div>

<div class="content">
    <div class="cards mt10 mb30"><!--Cards list--></div>
</div>

