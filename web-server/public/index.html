<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>
      Pomelo
    </title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta http-equiv="content-style-type" content="text/css" />
    <meta http-equiv="content-scripte-type" content="text/javascript" />
    <meta name="author" content="netease" />
    <meta name="version" content="1.0" />
    <meta name="keywords" content="pomelo" />
    <link type="text/css" rel="stylesheet" href="css/base.css" />
    <script src="js/lib/socket.io.js"></script>
    <!--script src="js/lib/pomeloclient.js"></script-->
    <script src="js/lib/build/build.js"></script>
    <script type="text/javascript">
      var pomelo = window.pomelo;
      var username = 'damien';
      var users;
      var rid;
      var base = 1000;
      var increase = 25;
      var reg = /^[a-zA-Z0-9_\u4e00-\u9fa5]+$/;
      var LOGIN_ERROR = "There is no server to log in, please wait.";
      var LENGTH_ERROR = "Name/Channel is too long or too short. 20 character max.";
      var NAME_ERROR = "Bad character in Name/Channel. Can only have letters, numbers, Chinese characters, and '_'";
      var DUPLICATE_ERROR = "Please change your name to login.";
//      var host = "127.0.0.1";
//      var port = "3010";
//      function show() {
//        pomelo.init({
//          host: host,
//          port: port,
//          log: true
//        }, function() {
//        pomelo.request("connector.entryHandler.entry", "hello pomelo", function(data) {
//            alert(data.msg);
//          });
//        });
//      }

      function show() {
        // request a connector
        pomelo.init({
          host: window.location.hostname,
          port: 3014,
          log : true
        }, function () {
          console.log('init OK');
          pomelo.request('gate.gateHandler.queryEntry', {
            uid: username
          }, function (data) {
            console.log('queryEntry OK');
            console.log(data);
            console.log('dispatched: ' + data.host + ':' + data.port);
            pomelo.disconnect();
            if (data.code === 500) {
              showError(LOGIN_ERROR);
              return;
            }
////          callback(data.host, data.port);
            // connect to connector
            pomelo.init({
              host: data.host,
              port: data.port,
              log : true
            }, function () {
              console.log('reinit OK');
              pomelo.request('connector.entryHandler.enter', {
                username: username,
                rid     : '#donut'
              }, function (data) {
                if (data.error) {
                  showError(DUPLICATE_ERROR);
                  return;
                }
                console.log('entry OK');
                console.log(data);
//                // @todo : ready to roll
//                console.log('connected');
//                console.log(data);
              });
            });
          });
        });
      }
    </script>
 
  </head>
  <body>
    <div class="g-doc">
      <div class="g-banner" style="border:none">
        <div class="logo">
          <div class="img"></div>
        </div>
      </div>
      <div class="g-background">
        <div class="g-content">
          Welcome to Pomelo
        </div>
      </div>
      <div class="g-link">
        Home:
        <a href="https://github.com/NetEase/pomelo">https://github.com/NetEase/pomelo</a>
      </div>
      <div class="g-button">
        <input id="test" type="button" value="Test Game Server" onclick="show()"/>
      </div>
    </div>
  </body>
</html>
